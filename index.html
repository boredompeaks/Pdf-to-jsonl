<!DOCTYPE html>

<html lang="en">



<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>PDF to jsonl v1</title> <!-- Version bump -->

    <style>

        /* --- Google Font Import --- */

        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700&display=swap');

        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap'); /* Keep Poppins for body */



        body {

            font-family: 'Poppins', sans-serif;

            line-height: 1.6;

            padding: 20px 10px;

            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);

            color: #e0e0e0;

            min-height: calc(100vh - 20px);

            overflow-x: hidden;

            box-sizing: border-box;

        }



        .container {

            max-width: 850px;

            margin: auto;

            padding: 30px;

            border-radius: 15px;

            background: rgba(255, 255, 255, 0.08);

            backdrop-filter: blur(15px);

            -webkit-backdrop-filter: blur(15px);

            border: 1px solid rgba(255, 255, 255, 0.18);

            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);

            transition: all 0.3s ease;

        }



        h1 {

            text-align: center;

            color: #00bcd4;

            font-weight: 600;

            margin-bottom: 35px;

            font-family: 'Orbitron', sans-serif;

            letter-spacing: 1.5px;

            text-shadow: 0 0 5px rgba(0, 188, 212, 0.5);

        }



        label {

            display: block;

            margin-bottom: 5px;

            font-weight: 400;

            color: #bdbdbd;

            font-size: 0.9em;

        }



        input[type="text"],

        input[type="password"],

        input[type="number"],

        select,

        textarea {

            width: 100%;

            padding: 10px 12px;

            margin-bottom: 10px;

            border: 1px solid rgba(255, 255, 255, 0.2);

            border-radius: 8px;

            box-sizing: border-box;

            background-color: rgba(0, 0, 0, 0.3);

            color: #e0e0e0;

            font-size: 0.95em;

            transition: border-color 0.3s ease, box-shadow 0.3s ease;

            font-family: 'Poppins', sans-serif;

        }



        select {

             appearance: none;

             -webkit-appearance: none;

             -moz-appearance: none;

             background-image: url('data:image/svg+xml;utf8,<svg fill="%23bdbdbd" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');

             background-repeat: no-repeat;

             background-position: right 10px center;

             background-size: 18px;

             padding-right: 35px;

        }



        input[type="text"]::placeholder,

        input[type="password"]::placeholder,

        input[type="number"]::placeholder,

        textarea::placeholder {

            color: #757575;

            opacity: 1;

        }



        input[type="text"]:focus,

        input[type="password"]:focus,

        input[type="number"]:focus,

        select:focus,

        textarea:focus {

            outline: none;

            border-color: #00bcd4;

            box-shadow: 0 0 8px rgba(0, 188, 212, 0.3);

        }



        textarea {

            height: 250px;

            resize: vertical;

            font-family: 'Courier New', Courier, monospace;

            font-size: 0.95em;

            line-height: 1.5;

        }



        button {

            background-color: #00bcd4;

            color: #111;

            padding: 10px 15px;

            border: none;

            border-radius: 8px;

            cursor: pointer;

            margin-right: 8px;

            font-size: 0.95em;

            font-weight: 600;

            margin-bottom: 10px;

            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;

            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);

            vertical-align: bottom;

             font-family: 'Poppins', sans-serif;

        }



        button:hover:not(:disabled) {

            background-color: #0097a7;

            transform: translateY(-1px);

            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);

        }



        button:active:not(:disabled) {

            transform: translateY(0px);

            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);

        }



        button:disabled {

            background-color: #555;

            color: #999;

            cursor: not-allowed;

            box-shadow: none;

            transform: none;

        }

        select:disabled {

             background-color: #555;

             color: #999;

             cursor: not-allowed;

             opacity: 0.7;

         }





        #stopButton {

            background-color: #e53935;

            color: #fff;

        }



        #stopButton:hover:not(:disabled) {

            background-color: #c62828;

        }



        #downloadButton {

            background-color: #4caf50;

            color: #fff;

        }



        #downloadButton:hover:not(:disabled) {

            background-color: #388e3c;

        }



        .select-pdf-button-container {

            margin-bottom: 20px;

            text-align: left;

        }



        .select-pdf-button-container button {

            background-color: transparent;

            border: 1px solid #00bcd4;

            color: #00bcd4;

            box-shadow: none;

            margin-right: 0;

            display: inline-block;

             padding: 10px 20px;

        }



        .select-pdf-button-container button:hover {

            background-color: rgba(0, 188, 212, 0.1);

            color: #26c6da;

            transform: translateY(-1px);

            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);

        }



        #dropZone {

            border: 2px dashed rgba(255, 255, 255, 0.3);

            border-radius: 10px;

            padding: 30px;

            text-align: center;

            margin-bottom: 20px;

            cursor: pointer;

            transition: border-color 0.3s ease, background-color 0.3s ease;

            color: #bdbdbd;

            background: rgba(255, 255, 255, 0.05);

            backdrop-filter: blur(5px);

            -webkit-backdrop-filter: blur(5px);

        }



        #dropZone.dragover,

        #dropZone:hover {

            border-color: #00bcd4;

            background-color: rgba(0, 188, 212, 0.1);

            color: #e0e0e0;

        }



        #fileList {

            list-style: none;

            padding: 0;

            margin-bottom: 20px;

            margin-top: 20px;

        }



        #fileList li {

            background: rgba(255, 255, 255, 0.06);

            backdrop-filter: blur(5px);

            -webkit-backdrop-filter: blur(5px);

            border: 1px solid rgba(255, 255, 255, 0.1);

            padding: 8px 12px;

            margin-bottom: 6px;

            border-radius: 8px;

            font-size: 0.9em;

            display: flex;

            justify-content: space-between;

            align-items: center;

            color: #ccc;

            transition: background-color 0.3s ease, border-color 0.3s ease;

        }



        #fileList li:hover {

            background: rgba(255, 255, 255, 0.1);

            border-color: rgba(255, 255, 255, 0.2);

        }



        #fileList li button {

            margin-left: 10px;

            padding: 2px 6px;

            font-size: 0.8em;

            margin-bottom: 0;

            background-color: rgba(229, 57, 53, 0.6);

            color: #fff;

            font-weight: 400;

            box-shadow: none;

            border-radius: 5px;

        }



        #fileList li button:hover {

            background-color: rgba(229, 57, 53, 0.9);

            transform: scale(1.05);

            box-shadow: none;

        }



        #status {

            margin-top: 15px;

            font-weight: 400;

            color: #bdbdbd;

            min-height: 1.6em;

            font-size: 0.95em;

        }



        .hidden-file-input {

            display: none;

        }



        .input-row {

            display: flex;

            flex-wrap: wrap;

            align-items: flex-start;

            gap: 15px;

            margin-bottom: 20px;

        }



        .input-row > div {

            flex: 1;

            min-width: 200px;

        }



        .input-row label {

            margin-bottom: 5px;

        }



        .button-group {

            margin-top: 5px;

            margin-bottom: 15px;

            text-align: left;

        }



        .button-group button {

            margin-bottom: 10px;

             margin-right: 10px;

        }

        .button-group button:last-child {

            margin-right: 0;

        }

    </style>

    <!-- PDF.js CDN -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"></script>

</head>



<body>

    <div class="container">

        <h1>PDF to ShareGPT Converter v0.9.1</h1>



        <!-- MODIFIED: Added onclick handler and updated text -->

        <div id="dropZone" onclick="document.getElementById('fileInput').click();">

            Drag & Drop up to 5 PDF files here, or click here to select.

        </div>

        <input type="file" id="fileInput" class="hidden-file-input" multiple accept=".pdf">



        <!-- ORIGINAL "Select PDFs" button remains functional -->

        <div class="select-pdf-button-container">

             <button type="button" onclick="document.getElementById('fileInput').click();">

                 Select PDFs

             </button>

        </div>



        <div class="input-row">

            <div>

                <label for="apiKey">OpenRouter API Key:</label>

                <input type="password" id="apiKey" placeholder="Enter your OpenRouter API Key">

            </div>

            <div>

                <label for="modelSelect">Select Model:</label>

                <select id="modelSelect">

                    <option value="deepseek/deepseek-chat-v3-0324" selected>DeepSeek V3 0324</option>

                    <option value="anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet</option>

                    <option value="google/gemini-2.5-flash-preview">Gemini 2.5 Flash Preview</option>

                    <option value="openai/gpt-4o">GPT-4o</option>

                    <option value="minimax/minimax-01">MiniMax-01</option>

                    <option value="anthropic/claude-3.7-sonnet">Claude 3.7 Sonnet</option>

                    <option value="openai/gpt-4o-mini">GPT-4o-mini</option>

                    <option value="google/gemini-2.0-flash-001">Gemini 2.0 Flash</option>
                    
                    <option value="google/gemini-2.0-flash-exp:free">gemini 2.0 flash exp</option>

                    <option value="deepseek/deepseek-chat">DeepSeek V3</option>

                    <option value="meta-llama/llama-4-maverick:free">Llama 4 Maverick (free)</option>

                    <option value="deepseek/deepseek-chat-v3-0324:free">DeepSeek V3 0324 (free)</option>

                    <option value="meta-llama/llama-4-scout:free">Llama 4 Scout (free)</option>

                    <option value="qwen/qwen3-235b-a22b:free">Qwen3 235B A22B (free)</option>

                </select>

            </div>

             <div>

                <label for="targetPairsInput">Target Pairs (0 for no limit):</label>

                <input type="number" id="targetPairsInput" min="0" value="1000" placeholder="e.g., 1000">

            </div>

        </div>



        <ul id="fileList"></ul>



        <div class="button-group">

            <button id="startButton">Start Generation</button>

            <button id="stopButton" disabled>Stop</button>

            <button id="downloadButton" disabled>Download JSON</button>

        </div>



        <div>

            <label for="output">Generated ShareGPT Data (JSON):</label>

            <textarea id="output" readonly placeholder="Generated conversation data will appear here..."></textarea>

        </div>

        <div id="status">Status: Idle</div>



    </div>



     <script>
        // Set workerSrc for pdf.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // DOM Elements
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const apiKeyInput = document.getElementById('apiKey');
        const targetPairsInput = document.getElementById('targetPairsInput');
        const modelSelect = document.getElementById('modelSelect');
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const outputTextArea = document.getElementById('output');
        const downloadButton = document.getElementById('downloadButton');
        const statusDiv = document.getElementById('status');
        const h1Title = document.querySelector('h1');
        const outputLabel = document.querySelector('label[for="output"]');

        // UI Updates
        h1Title.textContent = 'PDF to Cognitive Psychology Instruction Dataset';
        outputLabel.textContent = 'Generated Instruction Data (JSONL Format Preview):';

        // State Variables
        let pdfFiles = [];
        let instructionDataset = [];
        let isProcessing = false;
        let stopRequested = false;
        let currentPairs = 0;
        let targetPairs = 0;
        const MAX_FILES = 10;
        const PAGES_TO_SKIP_START = 20;
        const PAGES_TO_SKIP_END = 20;
        const BATCH_SIZE = 4;
        const RATE_LIMIT_DELAY = 1000;

        // Prompt Templates for Cognitive Psychology
        const promptTemplates = [
            {
                type: "Define & Explain",
                template: (book, context) => `From ${book}, define a key cognitive psychology concept found in the following text. Explain the underlying cognitive psychology mechanism that makes this principle effective, citing any key evidence or experiment mentioned in the text. Output a single JSON object with "instruction" and "output" keys, focusing only on cognitive psychology.\n---\n${context}\n---`
            },
            {
                type: "Analyze & Deconstruct",
                template: (book, context) => `Analyze the following scenario from ${book} based on cognitive psychology principles: ${context}. Identify and deconstruct the persuasive or cognitive techniques being used and explain how they are intended to work on the target's psychology. Output a single JSON object with "instruction" and "output" keys, focusing only on cognitive psychology.\n---\n${context}\n---`
            },
            {
                type: "Compare & Contrast",
                template: (book, context) => `From ${book}, compare and contrast two cognitive psychology concepts found in the following text. Explain how they are similar in their psychological mechanism and how they differ in their application. Output a single JSON object with "instruction" and "output" keys, focusing only on cognitive psychology.\n---\n${context}\n---`
            },
            {
                type: "Real-World Application",
                template: (book, context) => `From ${book}, describe a real-world example of a cognitive psychology concept found in the following text being used in a domain like marketing, policy, or user interface design. Explain its implementation and intended cognitive effect. Output a single JSON object with "instruction" and "output" keys, focusing only on cognitive psychology.\n---\n${context}\n---`
            },
            {
                type: "Creative Synthesis",
                template: (book, context) => `From ${book}, create a novel scenario (e.g., a marketing plan, dialogue, or user interface) that persuades a target audience using cognitive psychology concepts found in the following text. Justify how the chosen concepts are applied. Output a single JSON object with "instruction" and "output" keys, focusing only on cognitive psychology.\n---\n${context}\n---`
            }
        ];

        // File Handling
        function handleFiles(files) {
            const newlySelected = Array.from(files).filter(file => file.type === 'application/pdf');
            if (pdfFiles.length + newlySelected.length > MAX_FILES) {
                updateStatus(`Error: Cannot select more than ${MAX_FILES} PDF files.`, true);
                return;
            }
            newlySelected.forEach(newFile => {
                if (!pdfFiles.some(existingFile => existingFile.name === newFile.name)) {
                    pdfFiles.push(newFile);
                }
            });
            renderFileList();
            outputTextArea.value = '';
            instructionDataset = [];
            currentPairs = 0;
            updateStatus(`Ready to process ${pdfFiles.length} file(s).`);
            updateButtonStates();
        }

        function renderFileList() {
            fileList.innerHTML = '';
            pdfFiles.forEach((file, index) => {
                const li = document.createElement('li');
                const fileNameSpan = document.createElement('span');
                fileNameSpan.textContent = `${index + 1}. ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
                li.appendChild(fileNameSpan);
                const removeBtn = document.createElement('button');
                removeBtn.textContent = 'Remove';
                removeBtn.onclick = (e) => {
                    e.stopPropagation();
                    pdfFiles.splice(index, 1);
                    renderFileList();
                    outputTextArea.value = '';
                    instructionDataset = [];
                    currentPairs = 0;
                    updateStatus(`Removed file. Ready to process ${pdfFiles.length} file(s).`);
                    updateButtonStates();
                };
                li.appendChild(removeBtn);
                fileList.appendChild(li);
            });
        }

        dropZone.addEventListener('dragover', (event) => {
            event.preventDefault();
            dropZone.classList.add('dragover');
        });
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });
        dropZone.addEventListener('drop', (event) => {
            event.preventDefault();
            dropZone.classList.remove('dragover');
            handleFiles(event.dataTransfer.files);
        });
        fileInput.addEventListener('change', (event) => {
            handleFiles(event.target.files);
            fileInput.value = '';
        });

        // Status Update
        function updateStatus(message, isWarning = false) {
            console[isWarning ? 'warn' : 'log']("Status:", message);
            statusDiv.textContent = `Status: ${message}`;
            statusDiv.style.color = isWarning ? '#ffcc80' : '#bdbdbd';
        }

        // Download
        function triggerDownload() {
            if (instructionDataset.length === 0) {
                console.warn("triggerDownload called with no data.");
                return false;
            }
            try {
                const jsonlString = instructionDataset.map(item => JSON.stringify(item)).join('\n');
                const blob = new Blob([jsonlString], { type: 'application/jsonl' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                const modelNameSanitized = modelSelect.value.replace(/[^a-z0-9_-]/gi, '_');
                const filename = `psychology_instruction_dataset_${currentPairs}_pairs_${modelNameSanitized}.jsonl`;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                updateStatus(`JSONL file download initiated (${currentPairs} pairs) as ${filename}.`);
                return true;
            } catch (error) {
                console.error("Error creating download file:", error);
                updateStatus("Error creating download file.", true);
                return false;
            }
        }
        downloadButton.addEventListener('click', triggerDownload);

        // API Call
        async function callOpenRouterAPI(apiKey, context, book, templateIndex) {
            const selectedModel = modelSelect.value;
            if (!selectedModel) {
                updateStatus("Error: No model selected. Please choose a model from the list.", true);
                return { error: 'config_error', message: 'No model selected.' };
            }

            const baseURL = "https://openrouter.ai/api/v1";
            const headers = {
                "Authorization": `Bearer ${apiKey}`,
                "Content-Type": "application/json",
            };

            const systemPrompt = `You are an expert in cognitive psychology, specializing in persuasion and human behavior as described in books like Influence, Thinking, Fast and Slow, Pre-Suasion, Predictably Irrational, Made to Stick, and Nudge. Your task is to generate a single instruction-response pair in JSON format with "instruction" and "output" keys, based on the provided text and prompt template. Focus exclusively on cognitive psychology concepts and avoid non-psychology domains unless they directly relate to psychological applications (e.g., marketing, policy, or UI design). Ensure the response is concise, accurate, and grounded in the provided text.`;
            const userPrompt = promptTemplates[templateIndex].template(book, context);

            const messages = [
                { role: "system", content: systemPrompt },
                { role: "user", content: userPrompt }
            ];

            try {
                const response = await fetch(`${baseURL}/chat/completions`, {
                    method: "POST",
                    headers: headers,
                    body: JSON.stringify({
                        model: selectedModel,
                        messages: messages,
                        response_format: { type: "json_object" }
                    }),
                });

                if (!response.ok) {
                    if (response.status === 429) {
                        updateStatus("Rate limit exceeded. Pausing before retry...", true);
                        await new Promise(resolve => setTimeout(resolve, RATE_LIMIT_DELAY * 2));
                        return { error: 'rate_limit', message: 'Rate limit exceeded.' };
                    }
                    const errorBody = await response.text();
                    let detail = errorBody;
                    try { detail = JSON.parse(errorBody).error?.message || errorBody; } catch (e) {}
                    throw new Error(`API Error: ${response.status} ${response.statusText} - ${detail}`);
                }

                const completion = await response.json();
                const rawContent = completion.choices[0]?.message?.content?.trim();
                if (!rawContent) {
                    throw new Error("API Error: Received an empty response from the model.");
                }

                let parsedJson = JSON.parse(rawContent);
                if (typeof parsedJson !== 'object' || !parsedJson.instruction || !parsedJson.output) {
                    throw new Error("Parsed JSON does not contain required 'instruction' and 'output' keys.");
                }
                return {
                    ...parsedJson,
                    template_type: promptTemplates[templateIndex].type,
                    source_book: book
                };

            } catch (error) {
                console.error(`Error with API call or parsing:`, error);
                updateStatus(`Error: ${error.message}`, true);
                return { error: 'api_or_parse_error', message: error.message };
            }
        }

        // PDF Processing
        async function processPDFs(apiKey) {
            let templateIndex = 0;
            for (let fileIndex = 0; fileIndex < pdfFiles.length; fileIndex++) {
                if (!isProcessing) break;
                const file = pdfFiles[fileIndex];
                updateStatus(`Loading PDF ${fileIndex + 1}/${pdfFiles.length}: ${file.name}...`);
                let pdfDoc;
                const objectUrl = URL.createObjectURL(file);

                try {
                    pdfDoc = await pdfjsLib.getDocument(objectUrl).promise;
                    updateStatus(`Loaded ${file.name} (${pdfDoc.numPages} pages). Extracting text...`);
                    const startPage = PAGES_TO_SKIP_START + 1;
                    const endPage = pdfDoc.numPages - PAGES_TO_SKIP_END;
                    if (startPage > endPage) {
                        updateStatus(`Skipping ${file.name}: Not enough pages.`, true);
                        continue;
                    }

                    let fullText = '';
                    for (let pageNum = startPage; pageNum <= endPage; pageNum++) {
                        const page = await pdfDoc.getPage(pageNum);
                        const textContent = await page.getTextContent();
                        fullText += textContent.items.map(item => item.str).join(' ') + '\n';
                    }
                    fullText = fullText.replace(/\s+/g, ' ').trim();

                    const chunkSize = 2500;
                    const textChunks = [];
                    for (let i = 0; i < fullText.length; i += chunkSize) {
                        textChunks.push(fullText.substring(i, i + chunkSize));
                    }
                    updateStatus(`Split ${file.name} into ${textChunks.length} text chunks.`);

                    for (let chunkIndex = 0; chunkIndex < textChunks.length; chunkIndex += BATCH_SIZE) {
                        if (!isProcessing) break;

                        const batch = textChunks.slice(chunkIndex, chunkIndex + BATCH_SIZE);
                        const batchPromises = batch.map((context, idx) => {
                            const currentTemplateIndex = (templateIndex + idx) % promptTemplates.length;
                            return callOpenRouterAPI(apiKey, context, file.name, currentTemplateIndex);
                        });

                        const results = await Promise.all(batchPromises);
                        results.forEach((result, idx) => {
                            if (result && !result.error) {
                                instructionDataset.push({
                                    source_book: file.name,
                                    system: "You are a helpful assistant specialized in cognitive psychology, persuasion, and human behavior.",
                                    instruction: result.instruction,
                                    output: result.output,
                                    template_type: result.template_type
                                });
                                currentPairs++;
                                updateOutput();
                            } else if (result.error !== 'rate_limit') {
                                updateStatus(`Skipping chunk due to error: ${result?.message || 'Unknown error'}.`, true);
                                if (result?.error === 'config_error') {
                                    isProcessing = false;
                                }
                            }
                        });

                        templateIndex = (templateIndex + batch.length) % promptTemplates.length;
                        if (targetPairs > 0 && currentPairs >= targetPairs) {
                            isProcessing = false;
                            break;
                        }

                        await new Promise(resolve => setTimeout(resolve, RATE_LIMIT_DELAY));
                    }

                } catch (pdfError) {
                    console.error(`Error processing PDF ${file.name}:`, pdfError);
                    updateStatus(`Error processing PDF ${file.name}: ${pdfError.message}. Skipping.`, true);
                } finally {
                    URL.revokeObjectURL(objectUrl);
                    if (pdfDoc) await pdfDoc.destroy();
                }
                if (!isProcessing) break;
            }
        }

        function updateOutput() {
            try {
                const previewData = instructionDataset.slice(-50);
                const previewText = previewData.map(item => JSON.stringify(item)).join('\n');
                outputTextArea.value = `Displaying last ${previewData.length} of ${instructionDataset.length} total pairs...\n\n` + previewText;
                outputTextArea.scrollTop = outputTextArea.scrollHeight;
                updateButtonStates();
            } catch (e) {
                console.error("Error updating output text area:", e);
                outputTextArea.value = "Error displaying JSON data. See console.";
            }
        }

        // Control Button States
        function updateButtonStates() {
            const hasData = instructionDataset.length > 0;
            startButton.disabled = isProcessing;
            stopButton.disabled = !isProcessing;
            apiKeyInput.disabled = isProcessing;
            targetPairsInput.disabled = isProcessing;
            modelSelect.disabled = isProcessing;
            fileInput.disabled = isProcessing;
            document.querySelector('.select-pdf-button-container button').disabled = isProcessing;
            dropZone.style.pointerEvents = isProcessing ? 'none' : 'auto';
            dropZone.onclick = isProcessing ? null : () => document.getElementById('fileInput').click();
            dropZone.style.opacity = isProcessing ? 0.6 : 1;
            dropZone.style.cursor = isProcessing ? 'not-allowed' : 'pointer';
            fileList.querySelectorAll('button').forEach(btn => btn.disabled = isProcessing);
            downloadButton.disabled = isProcessing || !hasData;
        }

        // Start & Stop Buttons
        startButton.addEventListener('click', async () => {
            const apiKey = apiKeyInput.value.trim();
            if (!apiKey) {


</body>
                </html>


</html>
